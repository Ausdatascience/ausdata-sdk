{"version":3,"sources":["../src/server.ts"],"names":[],"mappings":"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","file":"chunk-TKXNGZDK.cjs","sourcesContent":["/**\r\n * Server-side utilities for @ausdata/sdk\r\n * \r\n * These utilities help create API proxy routes for Next.js and other frameworks\r\n * to avoid CORS issues and keep API keys secure on the server.\r\n */\r\n\r\nexport interface ProxyRequest {\r\n  path: string[];\r\n  method: string;\r\n  searchParams: URLSearchParams;\r\n  body?: string;\r\n}\r\n\r\nexport interface ProxyResponse {\r\n  status: number;\r\n  data?: unknown;\r\n  error?: {\r\n    code: string;\r\n    message: string;\r\n    details?: unknown;\r\n  };\r\n}\r\n\r\n/**\r\n * Get API key from environment variables\r\n */\r\nexport function getApiKey(): string | undefined {\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  const env = typeof process !== 'undefined' ? (process as any).env : undefined;\r\n  if (!env) return undefined;\r\n  \r\n  return (\r\n    env.AUSDATA_API_KEY ||\r\n    env.NEXT_PUBLIC_AUSDATA_API_KEY ||\r\n    env.VITE_AUSDATA_API_KEY\r\n  );\r\n}\r\n\r\n/**\r\n * Get base URL from environment variables or return default\r\n */\r\nexport function getBaseUrl(): string {\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  const env = typeof process !== 'undefined' ? (process as any).env : undefined;\r\n  if (!env) return 'https://api.ausdata.app/api/v1';\r\n  \r\n  return (\r\n    env.AUSDATA_BASE_URL ||\r\n    env.NEXT_PUBLIC_AUSDATA_BASE_URL ||\r\n    env.VITE_AUSDATA_BASE_URL ||\r\n    'https://api.ausdata.app/api/v1'\r\n  );\r\n}\r\n\r\n/**\r\n * Handle a proxy request to the Ausdata API\r\n * \r\n * This function can be used in Next.js API routes, Express routes, or other server frameworks.\r\n * \r\n * @example Next.js App Router\r\n * ```ts\r\n * import { handleProxyRequest } from '@ausdata/sdk/server';\r\n * import { NextRequest, NextResponse } from 'next/server';\r\n * \r\n * export async function GET(request: NextRequest, { params }: { params: Promise<{ path: string[] }> }) {\r\n *   const { path } = await params;\r\n *   const result = await handleProxyRequest({\r\n *     path,\r\n *     method: 'GET',\r\n *     searchParams: request.nextUrl.searchParams,\r\n *   });\r\n *   return NextResponse.json(result.data || result.error, { status: result.status });\r\n * }\r\n * ```\r\n * \r\n * @example Express\r\n * ```ts\r\n * import { handleProxyRequest } from '@ausdata/sdk/server';\r\n * \r\n * app.all('/api/*', async (req, res) => {\r\n *   const result = await handleProxyRequest({\r\n *     path: req.path.split('/').filter(Boolean),\r\n *     method: req.method,\r\n *     searchParams: new URLSearchParams(req.query as Record<string, string>),\r\n *     body: req.body ? JSON.stringify(req.body) : undefined,\r\n *   });\r\n *   res.status(result.status).json(result.data || result.error);\r\n * });\r\n * ```\r\n */\r\nexport async function handleProxyRequest(\r\n  request: ProxyRequest\r\n): Promise<ProxyResponse> {\r\n  const apiKey = getApiKey();\r\n  const baseUrl = getBaseUrl();\r\n\r\n  if (!apiKey) {\r\n    return {\r\n      status: 401,\r\n      error: {\r\n        code: 'AUTH_001',\r\n        message: 'API key is required. Please set AUSDATA_API_KEY or NEXT_PUBLIC_AUSDATA_API_KEY environment variable.',\r\n      },\r\n    };\r\n  }\r\n\r\n  try {\r\n    // Reconstruct the API path\r\n    const cleanPath = request.path.filter(p => p !== 'api').join('/');\r\n    const apiPath = `/${cleanPath}`;\r\n    const searchParams = request.searchParams.toString();\r\n    const url = `${baseUrl}${apiPath}${searchParams ? `?${searchParams}` : ''}`;\r\n\r\n    // Forward the request to the actual API\r\n    const response = await fetch(url, {\r\n      method: request.method,\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${apiKey}`,\r\n        'X-API-Key': apiKey,\r\n      },\r\n      body: request.body || undefined,\r\n    });\r\n\r\n    // Check if response is JSON\r\n    const contentType = response.headers.get('content-type');\r\n    if (contentType && contentType.includes('application/json')) {\r\n      const data = await response.json();\r\n      return {\r\n        status: response.status,\r\n        data,\r\n      };\r\n    } else {\r\n      const text = await response.text();\r\n      return {\r\n        status: response.status,\r\n        error: {\r\n          code: `HTTP_${response.status}`,\r\n          message: text || response.statusText,\r\n        },\r\n      };\r\n    }\r\n  } catch (error) {\r\n    console.error('API proxy error:', error);\r\n    return {\r\n      status: 500,\r\n      error: {\r\n        code: 'SRV_001',\r\n        message: error instanceof Error ? error.message : 'Internal server error',\r\n        details: error,\r\n      },\r\n    };\r\n  }\r\n}\r\n"]}